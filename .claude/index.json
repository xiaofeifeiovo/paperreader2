{
  "timestamp": "2026-01-13T00:00:00.000Z",
  "project": "PaperReader2",
  "version": "2.0.0",
  "scan_summary": {
    "total_files": 85,
    "scanned_files": 75,
    "coverage_percentage": 88.2,
    "truncated": false,
    "gaps": [
      "Phase 3: AIé—®ç­”åŠŸèƒ½æœªå®ç° (chat API, context_builder.py, llm_service.py)",
      "å‰ç«¯èŠå¤©ç•Œé¢ç»„ä»¶æœªå®ç°",
      "å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾ƒä½ (tests/)",
      "DOCXå¤„ç†å™¨æœªå®ç° (docx_processor.py)"
    ]
  },
  "modules": [
    {
      "name": "backend",
      "path": "backend/",
      "type": "python",
      "status": "active",
      "phase": 2,
      "entry_points": [
        "backend/app/main.py"
      ],
      "api_routes": [
        "backend/app/api/v1/health.py",
        "backend/app/api/v1/documents.py"
      ],
      "core_logic": [
        "backend/app/core/pdf_processor.py",
        "backend/app/core/document_processor.py"
      ],
      "models": [
        "backend/app/models/"
      ],
      "utils": [
        "backend/app/utils/logging_config.py",
        "backend/app/utils/performance.py"
      ],
      "tests": [
        "backend/tests/ (éƒ¨åˆ†å®Œæˆ)"
      ],
      "config_files": [
        "backend/requirements.txt",
        "backend/app/config.py"
      ],
      "data_directories": [
        "backend/data/uploads/",
        "backend/data/processed/markdown/",
        "backend/data/processed/images/"
      ],
      "coverage": {
        "entry_points": true,
        "api_routes": true,
        "core_logic": true,
        "models": true,
        "utils": true,
        "tests": false
      }
    },
    {
      "name": "frontend",
      "path": "frontend/",
      "type": "typescript-react",
      "status": "active",
      "phase": 2,
      "entry_points": [
        "frontend/src/main.tsx",
        "frontend/src/App.tsx"
      ],
      "router": [
        "frontend/src/router/index.tsx"
      ],
      "pages": [
        "frontend/src/pages/HomePage.tsx",
        "frontend/src/pages/DocumentViewPage.tsx"
      ],
      "components": [
        "frontend/src/components/FileUpload.tsx",
        "frontend/src/components/DocumentList.tsx",
        "frontend/src/components/MarkdownRenderer.tsx",
        "frontend/src/components/LazyImage.tsx",
        "frontend/src/components/DocumentViewer.tsx",
        "frontend/src/components/LoadingSpinner.tsx",
        "frontend/src/components/Notification.tsx"
      ],
      "layout": [
        "frontend/src/layout/MainLayout.tsx",
        "frontend/src/layout/Header.tsx",
        "frontend/src/layout/Sidebar.tsx"
      ],
      "store": [
        "frontend/src/store/documentStore.ts",
        "frontend/src/store/uiStore.ts"
      ],
      "services": [
        "frontend/src/services/client.ts",
        "frontend/src/services/document.ts",
        "frontend/src/services/health.ts"
      ],
      "hooks": [
        "frontend/src/hooks/useDocumentPolling.ts"
      ],
      "types": [
        "frontend/src/types/document.ts",
        "frontend/src/types/common.ts"
      ],
      "config_files": [
        "frontend/package.json",
        "frontend/vite.config.ts",
        "frontend/tsconfig.json",
        "frontend/tailwind.config.js"
      ],
      "coverage": {
        "entry_points": true,
        "router": true,
        "pages": true,
        "components": true,
        "layout": true,
        "store": true,
        "services": true,
        "hooks": true,
        "types": true
      }
    }
  ],
  "key_paths": {
    "root_readme": "CLAUDE.md",
    "devplan": "devplan.md",
    "backend_main": "backend/app/main.py",
    "backend_config": "backend/app/config.py",
    "backend_pdf_processor": "backend/app/core/pdf_processor.py",
    "backend_document_processor": "backend/app/core/document_processor.py",
    "backend_logging": "backend/app/utils/logging_config.py",
    "backend_performance": "backend/app/utils/performance.py",
    "frontend_app": "frontend/src/App.tsx",
    "frontend_router": "frontend/src/router/index.tsx",
    "frontend_document_store": "frontend/src/store/documentStore.ts",
    "frontend_markdown_renderer": "frontend/src/components/MarkdownRenderer.tsx",
    "frontend_lazy_image": "frontend/src/components/LazyImage.tsx",
    "frontend_document_viewer": "frontend/src/components/DocumentViewer.tsx",
    "frontend_polling_hook": "frontend/src/hooks/useDocumentPolling.ts"
  },
  "ignore_rules": {
    "venv": "backend/venv/**",
    "python_cache": "__pycache__/**/*.py[cod]",
    "node_modules": "frontend/node_modules/**",
    "data_uploads": "backend/data/uploads/**",
    "data_processed": "backend/data/processed/**",
    "ide": ".vscode/**,.idea/**",
    "logs": "*.log,logs/**",
    "pytest_cache": ".pytest_cache/**",
    "build_artifacts": "dist/**,build/**,.next/**"
  },
  "technology_stack": {
    "backend": {
      "language": "Python",
      "version": "3.9+",
      "framework": "FastAPI 0.109.0",
      "server": "Uvicorn 0.27.0",
      "pdf_processing": ["Pix2Text >=1.1.0", "PyMuPDF 1.23.8"],
      "docx_processing": "python-docx 1.1.0",
      "llm": "dashscope >=1.14.0 (Phase 3)",
      "token_counter": "tiktoken >=0.5.0 (Phase 3)",
      "data_validation": "Pydantic 2.9.2",
      "logging": "è‡ªå®šä¹‰å½©è‰²æ—¥å¿—ç³»ç»Ÿ",
      "performance_monitoring": "psutil >=5.9.0"
    },
    "frontend": {
      "language": "TypeScript",
      "version": "5.9+",
      "framework": "React 19.2.0",
      "build_tool": "Vite 7.2.4",
      "router": "react-router-dom 7.12.0",
      "state_management": "Zustand 5.0.10",
      "markdown": "react-markdown 10.1.0",
      "math": "KaTeX 0.16.27",
      "styling": "Tailwind CSS 3.4.19",
      "http_client": "Axios 1.13.2",
      "icons": "lucide-react 0.562.0"
    }
  },
  "api_endpoints": {
    "base_url": "http://127.0.0.1:8000",
    "api_prefix": "/api/v1",
    "health": [
      "GET /api/v1/health",
      "GET /api/v1/health/ping"
    ],
    "documents": [
      "POST /api/v1/documents/upload",
      "GET /api/v1/documents/list",
      "GET /api/v1/documents/{doc_id}",
      "GET /api/v1/documents/{doc_id}/images/{image_name}",
      "DELETE /api/v1/documents/{doc_id}"
    ],
    "chat": [
      "POST /api/v1/chat/message (Phase 3 - æœªå®ç°)"
    ]
  },
  "document_pipeline": {
    "steps": [
      "1. ç”¨æˆ·ä¸Šä¼ PDF â†’ POST /api/v1/documents/upload",
      "2. æ–‡ä»¶ä¿å­˜åˆ° data/uploads/{doc_id}/original.pdf",
      "3. åå°å¼‚æ­¥ä»»åŠ¡å¯åŠ¨ â†’ BackgroundTasks",
      "4. PDFå¤„ç† â†’ PDFProcessor.process() (Pix2Text OCR + PyMuPDFå›¾åƒæå–)",
      "5. Markdownç”Ÿæˆ â†’ ä¿å­˜åˆ° data/processed/markdown/{doc_id}.md",
      "6. å›¾åƒæå– â†’ ä¿å­˜åˆ° data/processed/images/{doc_id}/img_*.png",
      "7. çŠ¶æ€è½®è¯¢ â†’ useDocumentPolling Hook (æŒ‡æ•°é€€é¿: 3sâ†’5sâ†’10s)",
      "8. å‰ç«¯æ˜¾ç¤º â†’ MarkdownRenderer + LazyImage"
    ],
    "error_handling": {
      "strategy": "æ–‡ä»¶ç³»ç»Ÿä½œä¸ºçŠ¶æ€æ•°æ®åº“",
      "success": "{doc_id}.md æ–‡ä»¶å­˜åœ¨",
      "failure": "{doc_id}.error JSONæ–‡ä»¶ (å«é”™è¯¯è¯¦æƒ…å’Œå †æ ˆ)",
      "processing": "ä¸¤è€…éƒ½ä¸å­˜åœ¨"
    }
  },
  "environment_variables": {
    "required": [
      "DASHSCOPE_API_KEY"
    ],
    "optional": [
      "API_HOST (é»˜è®¤: 127.0.0.1)",
      "API_PORT (é»˜è®¤: 8000)",
      "QWEN_MODEL (é»˜è®¤: qwen-plus)",
      "PAPERREADER_DEVICE (auto/cuda/cpu - GPUæ§åˆ¶)",
      "LOG_LEVEL (é»˜è®¤: INFO)",
      "LOG_FILE (é»˜è®¤: None - ä»…ç»ˆç«¯)",
      "LOG_USE_COLOR (é»˜è®¤: true)",
      "USE_MARKER (é»˜è®¤: false)",
      "CORS_ORIGINS (é»˜è®¤: http://localhost:5173)",
      "MAX_FILE_SIZE (é»˜è®¤: 10MB)"
    ]
  },
  "key_design_patterns": {
    "lazy_loading": {
      "location": "backend/app/core/pdf_processor.py",
      "description": "Pix2Textæ¨¡å‹ä½¿ç”¨@propertyå»¶è¿ŸåŠ è½½,é¿å…å¯åŠ¨æ—¶ä¸‹è½½æ¨¡å‹(1-2åˆ†é’Ÿ)"
    },
    "error_isolation": {
      "location": "backend/app/core/document_processor.py",
      "description": "å¤±è´¥çš„æ–‡æ¡£å¤„ç†åˆ›å»º.erroræ–‡ä»¶,ä¸å½±å“å…¶ä»–æ–‡æ¡£å¤„ç†"
    },
    "file_system_state": {
      "location": "æ•´ä¸ªåç«¯æ¶æ„",
      "description": "ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿä½œä¸ºçŠ¶æ€æ•°æ®åº“,æ— éœ€é¢å¤–æ•°æ®åº“å±‚"
    },
    "gpu_detection": {
      "location": "backend/app/core/pdf_processor.py detect_device()",
      "description": "å¤šå±‚æ£€æµ‹: ç¯å¢ƒå˜é‡ â†’ CUDAå¯ç”¨æ€§ â†’ CPUé™çº§,è‡ªåŠ¨ä¼˜é›…é™çº§"
    },
    "exponential_backoff_polling": {
      "location": "frontend/src/hooks/useDocumentPolling.ts",
      "description": "æ–‡æ¡£çŠ¶æ€è½®è¯¢ä½¿ç”¨æŒ‡æ•°é€€é¿(3sâ†’5sâ†’10s),å‡å°‘æœåŠ¡å™¨è´Ÿè½½"
    },
    "dual_store_pattern": {
      "location": "frontend/src/store/",
      "description": "DocumentStore(ä¸šåŠ¡çŠ¶æ€) + UIStore(UIçŠ¶æ€),å…³æ³¨ç‚¹åˆ†ç¦»"
    },
    "colored_logging": {
      "location": "backend/app/utils/logging_config.py",
      "description": "è‡ªå®šä¹‰å½©è‰²æ—¥å¿—ç³»ç»Ÿ,å¸¦emojiæ ‡è¯†,æ”¯æŒç»ˆç«¯å’Œæ–‡ä»¶åŒè¾“å‡º"
    },
    "performance_monitoring": {
      "location": "backend/app/utils/performance.py",
      "description": "PerformanceMonitorç±»ç›‘æ§æ—¶é—´ã€å†…å­˜ã€CPUä½¿ç”¨ç‡"
    }
  },
  "development_phase": {
    "current": "Phase 2: PDFå¤„ç†ä¸Markdownæ¸²æŸ“ (æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ âœ…)",
    "completed": [
      "FastAPIåº”ç”¨å…¥å£å’Œé…ç½®ç®¡ç†",
      "å¥åº·æ£€æŸ¥API",
      "æ–‡æ¡£ä¸Šä¼ API (æ”¯æŒæ–‡ä»¶éªŒè¯å’Œå¤§å°é™åˆ¶)",
      "PDFå¤„ç†å™¨ (Pix2Text OCR + PyMuPDFå›¾åƒæå–)",
      "åå°å¼‚æ­¥ä»»åŠ¡å¤„ç†",
      "GPUè‡ªåŠ¨æ£€æµ‹å’Œä¼˜é›…é™çº§",
      "é”™è¯¯éš”ç¦»æœºåˆ¶ (.erroræ–‡ä»¶)",
      "å½©è‰²æ—¥å¿—ç³»ç»Ÿ",
      "æ€§èƒ½ç›‘æ§å·¥å…·",
      "React + Vite å‰ç«¯é¡¹ç›®",
      "React Router v7 è·¯ç”±é…ç½®",
      "Zustand çŠ¶æ€ç®¡ç† (DocumentStore + UIStore)",
      "Markdownæ¸²æŸ“ç»„ä»¶ (react-markdown + KaTeX)",
      "å›¾åƒæ‡’åŠ è½½ç»„ä»¶ (Intersection Observer)",
      "æ–‡æ¡£æŸ¥çœ‹å™¨ (å¸¦æ»šåŠ¨è¿›åº¦)",
      "æ–‡æ¡£çŠ¶æ€è½®è¯¢ (æŒ‡æ•°é€€é¿ç­–ç•¥)",
      "æ–‡æ¡£åˆ—è¡¨å’Œä¸Šä¼ åŠŸèƒ½",
      "ç±»å‹å®‰å…¨ (TypeScript + Pydantic)"
    ],
    "in_progress": [
      "å•å…ƒæµ‹è¯•ç¼–å†™",
      "æ–‡æ¡£å®Œå–„"
    ],
    "next_phase": "Phase 3: AIé—®ç­”åŠŸèƒ½ (è®¡åˆ’ä¸­ ğŸ“‹)"
  },
  "critical_implementation_details": {
    "gpu_device_control": {
      "env_var": "PAPERREADER_DEVICE",
      "values": {
        "auto": "è‡ªåŠ¨æ£€æµ‹CUDA (é»˜è®¤)",
        "cuda": "å¼ºåˆ¶ä½¿ç”¨GPU",
        "cpu": "å¼ºåˆ¶ä½¿ç”¨CPU"
      },
      "fallback": "GPUåˆå§‹åŒ–å¤±è´¥è‡ªåŠ¨åˆ‡æ¢CPU"
    },
    "document_status_values": {
      "frontend_local": "uploading",
      "backend_processing": "processing",
      "backend_ready": "ready (æ³¨æ„: ä¸æ˜¯ 'completed')",
      "backend_error": "error (æ³¨æ„: ä¸æ˜¯ 'failed')"
    },
    "api_response_formats": {
      "document_content": {
        "doc_id": "uuid",
        "content": "Markdownæ–‡æœ¬ (æ³¨æ„: å­—æ®µåæ˜¯ 'content' ä¸æ˜¯ 'markdown')",
        "images": ["img_001", "img_002"],
        "status": "ready/error"
      },
      "document_info": {
        "doc_id": "uuid",
        "filename": "åŸå§‹æ–‡ä»¶å",
        "upload_time": "Unixæ—¶é—´æˆ³(æµ®ç‚¹æ•°, ä¸æ˜¯å­—ç¬¦ä¸²)",
        "file_size": "å­—èŠ‚æ•°",
        "status": "ready/processing/error"
      }
    },
    "image_extraction": {
      "library": "PyMuPDF (fitz)",
      "format": "PNG",
      "naming": "img_{index:03d}.png",
      "deduplication": "ä½¿ç”¨xrefå»é‡",
      "metadata_logging": "PILè®°å½•å°ºå¯¸ã€æ ¼å¼ã€è‰²å½©æ¨¡å¼"
    }
  },
  "testing_status": {
    "backend": {
      "framework": "pytest",
      "async_support": "pytest-asyncio",
      "coverage": "ä½ (éœ€è¦è¡¥å……)",
      "test_files": []
    },
    "frontend": {
      "framework": "æœªé…ç½®",
      "coverage": "æ— "
    }
  },
  "service_urls": {
    "frontend": "http://localhost:5173",
    "backend_api": "http://localhost:8000",
    "swagger_ui": "http://localhost:8000/api/docs",
    "redoc": "http://localhost:8000/api/redoc",
    "health_check": "http://localhost:8000/api/v1/health"
  },
  "recommendations": {
    "priority_tasks": [
      "è¡¥å……å•å…ƒæµ‹è¯• (backend/app/core/, frontend/src/components/)",
      "å®ç°Phase 3: AIé—®ç­”åŠŸèƒ½ (context_builder.py, llm_service.py, chat API)",
      "æ·»åŠ å‰ç«¯èŠå¤©ç•Œé¢ç»„ä»¶",
      "å®ç°DOCXå¤„ç†å™¨ (docx_processor.py)",
      "ä¼˜åŒ–å¤§æ–‡æ¡£å¤„ç†æ€§èƒ½",
      "æ·»åŠ æ–‡æ¡£æœç´¢åŠŸèƒ½"
    ],
    "next_scan_directories": [
      "backend/tests/ (å¾…è¡¥å……)",
      "frontend/src/components/chat/ (å¾…å®ç° Phase 3)",
      "backend/app/core/context_builder.py (å¾…å®ç° Phase 3)",
      "backend/app/core/llm_service.py (å¾…å®ç° Phase 3)"
    ],
    "improvements": [
      "æ·»åŠ APIå“åº”ç¼“å­˜",
      "å®ç°WebSocketæ›¿ä»£è½®è¯¢",
      "æ·»åŠ æ–‡æ¡£å¯¼å‡ºåŠŸèƒ½ (PDF/EPUB)",
      "å®ç°æ–‡æ¡£æ‰¹æ³¨åŠŸèƒ½",
      "æ·»åŠ æš—é»‘æ¨¡å¼æ”¯æŒ"
    ]
  },
  "known_issues": [
    "Pix2Texté¦–æ¬¡åŠ è½½éœ€è¦1-2åˆ†é’Ÿ(æ¨¡å‹ä¸‹è½½)",
    "å¤§æ–‡ä»¶(>10MB)å¤„ç†å¯èƒ½è¶…æ—¶",
    "å‰ç«¯è½®è¯¢ä¼šäº§ç”Ÿä¸å¿…è¦çš„APIè¯·æ±‚",
    "æ²¡æœ‰æ–‡æ¡£æœç´¢åŠŸèƒ½",
    "ä¸æ”¯æŒå¤šè¯­è¨€ç•Œé¢"
  ],
  "metadata": {
    "created_at": "2026-01-12T00:00:00.000Z",
    "last_updated": "2026-01-13T00:00:00.000Z",
    "scan_version": "2.0.0",
    "scanner": "Initialization Architect (Adaptive Version)",
    "scan_duration_seconds": 45,
    "total_files_skipped": 10,
    "skip_reasons": [
      "node_modules/ (ä¾èµ–åŒ…)",
      "venv/ (è™šæ‹Ÿç¯å¢ƒ)",
      "__pycache__/ (Pythonç¼“å­˜)",
      "data/ (è¿è¡Œæ—¶æ•°æ®)"
    ]
  }
}
